# 覆蓋率門檻 + 自動切換 UI 計畫

## 目標
- 高覆蓋率時不再依賴縮略條，改用差異段落導覽，確保可用性。
- 低/中覆蓋率時維持縮略條帶來的空間感與快速跳轉。

## 核心概念
- 覆蓋率 (coverage) 作為模式切換信號。
- 視覺導覽分成三種模式：Minimap / Hybrid / Chunks。

## 覆蓋率計算
- Side/Inline: coverage = diffLines / totalLines
- Tree: coverage = diffNodes / totalNodes
- 輔助指標: diff chunks 數量 (例如 > 200 也視為高密度)

## 切換規則 (預設)
- coverage < 0.40 => Minimap
- 0.40 <= coverage <= 0.80 => Hybrid
- coverage > 0.80 => Chunks

## UI 模式定義
- Minimap: 顯示縮略條 (細線/熱度) + 點擊跳轉。
- Hybrid: 縮略條 + 差異段落列表 (簡化版)。
- Chunks: 以段落列表為主，縮略條可隱藏或降級為極簡提示。

## 差異段落列表 (Chunks)
- 顯示項目: 段落編號、起訖範圍、差異類型比例/摘要。
- 操作: 點擊跳轉、篩選 added/removed/modified。
- 狀態: 顯示當前段落 (active) 與覆蓋率提示。

## 互動流程
- Diff 完成后計算 coverage => 選擇預設模式。
- 提供模式切換按鈕 (記住使用者偏好)。
- 高密度時顯示提示: 「差異覆蓋過高，已切換段落模式」。

## 任務拆解
- [x] 增加 coverage 計算 (Side/Inline/Tree 共用)。
- [x] 定義 overviewMode 狀態與門檻。
- [x] 建立 DiffChunkList 元件 (段落列表 + 跳轉)。
- [x] Minimap/Hybrid/Chunks UI 切換。
- [x] 覆蓋率提示文案 + 模式切換提示。
- [ ] 記住使用者偏好 (localStorage)。

## 驗收指標
- coverage > 80% 時預設進入段落模式。
- 任何模式下皆可快速跳到差異。
- 模式切換不影響既有導覽與效能。

## 風險與備註
- Chunk 分段策略需避免過碎。
- 高密度下縮略條可能仍需降級或隱藏。

# 輸入區剖析模式（Inspect）

## 目標
- 不依賴比對即可理解 XML 結構，快速找到資料。
- XML A / XML B 可單側剖析，互不影響。

## 核心概念
- 新增「比對 / 分析」模式切換。
- 分析模式下提供完整行號、摺疊展開、樹狀導覽與搜尋。

## 主要功能
- 單側剖析：A/B 任一側即可使用分析模式。
- 完整行號：固定行號欄，捲動同步對齊內容。
- 摺疊/展開：以節點層級為單位摺疊，支援展開全部/收合全部。
- 樹狀導覽：左側樹狀視圖，點擊節點跳轉對應行。
- 搜尋：節點名/屬性/文字內容搜尋，結果可跳轉。
- 大檔降級：在大型 XML 下關閉語法高亮、改用預覽/延遲渲染。

## UI 變化
- 輸入區上方新增模式切換（比對 / 分析）。
- 分析模式下，差異摘要/導覽/下載等比對專屬區塊隱藏或收起。
- 每側提供「搜尋 + 樹狀導覽 + 內容」三區塊布局（可收合）。

## 任務拆解
- [x] 新增模式狀態（compare/inspect）並接入 UI。
- [x] 輸入區補齊行號欄與同步捲動。
- [x] 節點摺疊/展開（含展開全部/收合全部）。
- [x] 樹狀導覽與行號跳轉。
- [ ] 搜尋功能（節點/屬性/文字）與結果跳轉。
- [ ] 大檔模式降級與提示。

## 驗收指標
- 單側 XML 可獨立剖析並快速定位節點。
- 行號與內容同步捲動，不產生錯位。
- 摺疊/展開與搜尋跳轉在大檔下仍可用。

## 風險與備註
- 行號與內容同步需避免大量 DOM 造成卡頓。
- 大檔需維持降級策略，避免渲染造成阻塞。
